package com.bootcamp.BankCoin.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.server.ResponseStatusException;

import com.bootcamp.BankCoin.model.BankTasa;
import com.bootcamp.BankCoin.service.BankTasaService;

import lombok.extern.slf4j.Slf4j;
import reactor.core.publisher.Mono;

@Slf4j
@RestController
@RequestMapping("/bankTasa")
public class BankTasaController {

	@Autowired
	BankTasaService bankTasaService;
	
	@PostMapping
	public Mono<BankTasa> createBankTasa(@RequestBody BankTasa bankTasa) {
 

			try {

				var typeCostumer = this.customerTypeSerivce.getCustomerTypebyId(customerType.getId());

				List<CustomerType> list1 = new ArrayList<>();

				typeCostumer.flux().collectList().subscribe(list1::addAll);

				long temporizador = (3 * 1000);
				Thread.sleep(temporizador);

				log.info("Obtener valor para validar Id --->" + list1); 

				if (codigoValidator != 0 && codigoValidator.equals(customerType.getId())) {
					return Mono.error(new ResponseStatusException(HttpStatus.PRECONDITION_FAILED,
							"El Id de Tipo Cliente ya existe"));
				} else {
					return this.bankTasaService.createBankTasa(bankTasa);
				}

			} catch (InterruptedException e) {
				log.info(e.toString());
				Thread.currentThread().interrupt();
				return Mono.error(new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage()));
			}
 

	}
}
